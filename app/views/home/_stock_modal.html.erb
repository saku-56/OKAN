<dialog id="stock_modal" class="modal modal-open">
  <div class="modal-box max-w-md">
    <% if @date < Date.current %>
      <p class="text-gray-500">
        過去の在庫は表示できません。
      </p>
    <% elsif @medicines_with_stock.any? %>
      <!-- ヘッダー -->
      <h3 class="font-bold text-lg mb-4">
        <%= @date.strftime('%m月%d日') %> の在庫予定
      </h3>
      <div class="space-y-1">
        <!-- 各薬の在庫情報 -->
        <% @medicines_with_stock.each do |medicine| %>
          <% stock = medicine.stock_on(@date) %>
          <%= link_to user_medicine_path(medicine),
                class: "block p-3 rounded-lg border #{stock_card_classes(stock)}",
                data: { turbo_frame: "_top" } do %>
            <div class="flex items-start">
              <div class="flex-1">
                <div class="text-gary-800 font-medium mb-1">
                  <%= medicine.medicine.name %>：<%= medicine.stock_on(@date) %>錠
                  <%= stock_status_badge(stock) %>
                </div>
              </div>
            </div>
          <% end %>
        <% end %>
      </div>
    <% else %>
      <p class="text-gray-500 text-center py-4">
        この日は在庫がありません。
      </p>
    <% end %>
    <!-- 通院予定の表示 -->
    <% if @selected_schedules.present? %>
      <div class="mb-4">
        <h3 class="font-bold text-lg mt-4 mb-2">通院予定</h3>
        <% @selected_schedules.each do |schedule| %>
          <%= link_to hospital_path(schedule.hospital), class: "border bg-white hover:bg-gray-50 block p-3 rounded-lg",
                                                        data: { turbo_frame: "_top" }  do%>
            <%= schedule.hospital.name %>
          <% end %>
        <% end %>
      </div>
    <% end %>
    <!-- 閉じるボタン -->
    <div class="modal-action">
      <%= link_to "閉じる",
            home_path,
            class: "btn" %>
    </div>
  </div>
  <!-- 背景クリックで閉じる -->
  <form method="dialog" class="modal-backdrop">
    <%= link_to "", home_path %>
  </form>
</dialog>