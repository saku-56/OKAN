<div class="container mx-auto px-4 py-8">
  <!-- 残薬一覧エリア -->
  <div class="leftover-medicines-section max-w-4xl mx-auto mb-8">
    <!-- ✅ 今日の日付を表示 -->
    <h2 class="text-2xl font-bold text-center mb-6">
      <%= l(Date.today, format: :long) %>
    </h2>

    <% if @medicines_with_stock.any? %>
      <table class="table w-full bg-white shadow-md rounded-lg overflow-hidden">
        <tbody>
          <% @medicines_with_stock.each do |user_medicine| %>
            <tr class="border-b">
              <td class="px-6 py-4"><%= user_medicine.medicine_name %></td>
              <td class="px-6 py-4 text-right">残り<%= user_medicine.current_stock %>錠</td>
            </tr>
          <% end %>
        </tbody>
      </table>
    <% else %>
      <p class="text-center text-gray-500 py-8">現在、薬はありません。</p>
    <% end %>
  </div>

  <!-- カレンダー表示エリア -->
  <div class="calendar-section max-w-4xl mx-auto mb-8">
    <%= month_calendar do |date| %>
      <%= link_to date.day,
        user_medicines_path(date: date),
        data: { turbo_frame: "stock_modal" } %>

      <!-- カレンダー上の残り10錠表示 -->
      <% @medicines_with_stock.each do |medicine| %>
        <% stock = medicine.stock_on(date) %>
        <% if stock == 10 %>
          <span class="block text-xs text-error">
            <%= medicine.medicine_name %>：残り10錠
          </span>
        <% end %>
      <% end %>
    <% end %>
  </div>

  <!-- 登録薬管理へのリンク -->
  <div class="actions text-center">
    <%= link_to "薬の追加", select_medicine_user_medicines_path, class: "btn btn-primary" %>
  </div>

  <!-- モーダル枠 -->
  <turbo-frame id="stock_modal">
    <% if params[:date].present? %>
      <%= render "stock_modal" %>
    <% end %>
  </turbo-frame>

</div>