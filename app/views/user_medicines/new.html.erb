<div class="container mx-auto px-4 py-8">
  <h1 class="text-2xl font-bold mb-6">服薬情報の登録</h1>

  <%= form_with model: @user_medicine, url: user_medicines_path, local: true do |f| %>
    <% if @user_medicine.errors.any? %>
      <div class="bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4">
        <ul>
          <% @user_medicine.errors.full_messages.each do |message| %>
            <li><%= message %></li>
          <% end %>
        </ul>
      </div>
    <% end %>

    <!-- 薬の情報セクション -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4">薬の情報</h2>

      <% if @selected_medicine.present? %>
        <!-- 既存の薬が選択されている場合 -->
        <div class="bg-blue-50 p-4 rounded mb-4">
          <p class="text-sm text-gray-600 mb-2">選択された薬</p>
          <p class="font-semibold text-lg"><%= @selected_medicine.name %></p>
          <p class="text-gray-600">1回の服薬量: <%= @selected_medicine.dosage_per_time %>錠</p>
        </div>
        <%= f.hidden_field :medicine_id, value: @selected_medicine.id %>

        <div class="mt-4">
          <%= link_to '別の薬を選択する',
              select_medicine_user_medicines_path,
              class: 'text-blue-500 hover:underline' %>
        </div>

      <% else %>
        <!-- 新規登録の場合 -->
        <div class="space-y-4">
          <div>
            <%= label_tag :new_medicine_name, '薬名', class: 'block text-sm font-medium mb-2' %>
            <%= text_field_tag 'user_medicine[new_medicine_name]', '',
                class: 'w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500',
                placeholder: '薬名を入力してください' %>
          </div>

          <div>
            <%= label_tag :new_medicine_dosage, '1回の服薬量（錠）', class: 'block text-sm font-medium mb-2' %>
            <%= number_field_tag 'user_medicine[new_medicine_dosage]', '',
                class: 'w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500',
                placeholder: '例: 1',
                step: '0.5',
                min: '0' %>
          </div>
        </div>
      <% end %>
    </div>

    <!-- 処方情報セクション -->
    <div class="bg-white rounded-lg shadow p-6 mb-6">
      <h2 class="text-xl font-semibold mb-4">処方情報</h2>

      <div class="space-y-4">
        <div>
          <%= f.label :prescribed_amount, '処方量（錠）', class: 'block text-sm font-medium mb-2' %>
          <%= f.number_field :prescribed_amount,
              class: 'w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500',
              placeholder: '例: 30',
              min: '0' %>
        </div>

        <div>
          <%= f.label :start_date, '服用開始日', class: 'block text-sm font-medium mb-2' %>
          <%= f.date_field :start_date,
              class: 'w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500',
              value: Date.today %>
        </div>

        <div>
          <%= f.label :current_stock, '現在の残量（錠）', class: 'block text-sm font-medium mb-2' %>
          <%= f.number_field :current_stock,
              class: 'w-full px-3 py-2 border border-gray-300 rounded focus:outline-none focus:ring-2 focus:ring-blue-500',
              placeholder: '例: 30',
              min: '0' %>
          <p class="text-sm text-gray-500 mt-1">※ 処方量と同じ場合が多いです</p>
        </div>
      </div>
    </div>

    <!-- ボタンエリア -->
    <div class="flex gap-4">
      <%= f.submit '登録する',
          class: 'flex-1 bg-blue-500 text-white px-6 py-3 rounded hover:bg-blue-600 focus:outline-none focus:ring-2 focus:ring-blue-500' %>
      <%= link_to 'キャンセル',
          select_medicine_user_medicines_path,
          class: 'flex-1 bg-gray-300 text-gray-700 px-6 py-3 rounded text-center hover:bg-gray-400' %>
    </div>
  <% end %>
</div>