<%= form_with model: hospital do |f| %>
<%= render "shared/error_messages", object: f.object %>

<div class="bg-white rounded-lg shadow p-6 mb-3">

  <!-- 病院情報セクション -->
  <div class="bg-white rounded-lg shadow-sm p-3 mb-3">
    <div class="mb-2">
      <%= f.label :name, class: "block text-xs font-semibold text-gray-700 mb-1" %>
      <%= f.text_field :name, class: "w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500" %>
    </div>

    <div class="mb-2">
      <%= f.label :description, class: "block text-xs font-semibold text-gray-700 mb-1" %>
      <%= f.text_area :description, rows: 2, class: "w-full px-2 py-1.5 text-sm border border-gray-300 rounded focus:ring-1 focus:ring-blue-500" %>
    </div>
  </div>

  <!-- 診療時間 -->
  <div class="mb-6">
    <h2 class="text-lg font-bold mb-4">診療時間</h2>

    <div class="space-y-4">
      <% # 曜日順にソート
         schedules_by_day = @hospital.hospital_schedules
                                     .sort_by { |s| [s.day_of_week.to_i, s.period.to_i] }
                                     .group_by(&:day_of_week) %>

      <% HospitalSchedule.day_of_weeks.keys.each do |day| %>
        <% schedules = schedules_by_day[day] || [] %>
        <% morning = schedules.find { |s| s.period == "morning" } %>
        <% afternoon = schedules.find { |s| s.period == "afternoon" } %>

        <div class="border border-gray-300 rounded-lg p-3 bg-white">
          <!-- 曜日 -->
          <div class="font-bold text-gray-800 mb-3 text-center sm:text-left">
            <%= HospitalSchedule.day_of_weeks_i18n[day.to_sym] %>
          </div>

          <!-- 午前 -->
          <div class="mb-3">
            <div class="text-xs text-gray-600 mb-1">午前</div>
            <%= f.fields_for :hospital_schedules, morning do |sf| %>
              <%= sf.hidden_field :id if sf.object.persisted? %>
              <%= sf.hidden_field :day_of_week %>
              <%= sf.hidden_field :period %>
              <div class="flex items-center gap-1 text-xs">
                <!-- 午前開始時間 -->
               <%= sf.select :start_time,
                             options_for_select(morning_time_options, sf.object.start_time&.strftime("%H:%M")),
                             { include_blank: true },
                             class: "w-24 border #{sf.object.errors[:start_time].any? ? "border-red-500" : "border-gray-300"} rounded px-2 py-1" %>

                <span class="text-gray-500">〜</span>

                <!-- 午前終了時間 -->
                <%= sf.select :end_time,
                              options_for_select(morning_time_options, sf.object.end_time&.strftime("%H:%M")),
                              { include_blank: true },
                              class: "w-24 border #{sf.object.errors[:end_time].any? ? "border-red-500" : "border-gray-300"} rounded px-2 py-1" %>

                <span class="text-gray-400 ml-1">(休診の場合は空欄)</span>
              </div>
            <% end %>
          </div>

          <!-- 午後 -->
          <div>
            <div class="text-xs text-gray-600 mb-1">午後</div>
            <%= f.fields_for :hospital_schedules, afternoon do |sf| %>
              <%= sf.hidden_field :id if sf.object.persisted? %>
              <%= sf.hidden_field :day_of_week %>
              <%= sf.hidden_field :period %>
              <div class="flex items-center gap-1 text-xs">
                <!-- 午後開始時間 -->
                <%= sf.select :start_time,
                              options_for_select(afternoon_time_options, sf.object.start_time&.strftime("%H:%M")),
                              { include_blank: true },
                              class: "w-24 border #{sf.object.errors[:start_time].any? ? "border-red-500" : "border-gray-300"} rounded px-2 py-1" %>

                <span class="text-gray-500">〜</span>

                <!-- 午後終了時間 -->
                <%= sf.select :end_time,
                              options_for_select(afternoon_time_options, sf.object.end_time&.strftime("%H:%M")),
                              { include_blank: true },
                              class: "w-24 border #{sf.object.errors[:end_time].any? ? "border-red-500" : "border-gray-300"} rounded px-2 py-1" %>

                <span class="text-gray-400 ml-1">(休診の場合は空欄)</span>
              </div>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  </div>
  <!-- 送信ボタン -->
  <div class="flex gap-4 p-6">
    <%= f.submit nil, class: "btn btn-primary flex-1" %>
    <%= link_to "戻る", hospitals_path, class: "btn btn-neutral flex-1" %>
  </div>
</div>
<% end %>